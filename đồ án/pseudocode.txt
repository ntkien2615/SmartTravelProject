================================================================================
           PSEUDOCODE - CHÆ¯Æ NG TRÃŒNH TÃŒM ÄÆ¯á»œNG ÄI NGáº®N NHáº¤T
================================================================================

------------------------------------------------------------
HÃ€M GEOCODE(q):
------------------------------------------------------------
INPUT: q - Äá»‹a chá»‰ dáº¡ng chuá»—i (string)
OUTPUT: (lat, lon, name) - Tá»a Ä‘á»™ vÃ  tÃªn Ä‘á»‹a Ä‘iá»ƒm

Báº®T Äáº¦U
    CHá»œ 1 giÃ¢y                           // TrÃ¡nh spam API
    Gá»¬I request Ä‘áº¿n Nominatim API vá»›i query = q
    NHáº¬N response dáº¡ng JSON
    
    Náº¾U response rá»—ng:
        RAISE ValueError("KhÃ´ng tÃ¬m tháº¥y Ä‘á»‹a chá»‰")
    
    result â† response[0]                 // Láº¥y káº¿t quáº£ Ä‘áº§u tiÃªn
    lat â† chuyá»ƒn result["lat"] sang float
    lon â† chuyá»ƒn result["lon"] sang float
    name â† result["display_name"]
    
    TRáº¢ Vá»€ (lat, lon, name)
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M OSRM_GEOM(lon1, lat1, lon2, lat2, vehicle_type):
------------------------------------------------------------
INPUT: 
    - lon1, lat1: Tá»a Ä‘á»™ Ä‘iá»ƒm báº¯t Ä‘áº§u
    - lon2, lat2: Tá»a Ä‘á»™ Ä‘iá»ƒm Ä‘Ã­ch
    - vehicle_type: "driving" hoáº·c "bike"
OUTPUT: (geometry, khoáº£ng_cÃ¡ch_km, thá»i_gian_giá»)

Báº®T Äáº¦U
    url â† "https://router.project-osrm.org/route/v1/{vehicle_type}/{lon1},{lat1};{lon2},{lat2}"
    params â† {overview: "full", geometries: "geojson"}
    
    Gá»¬I GET request Ä‘áº¿n url vá»›i params
    NHáº¬N response dáº¡ng JSON
    
    route â† response["routes"][0]
    geometry â† route["geometry"]         // GeoJSON LineString
    distance_km â† route["distance"] / 1000
    duration_hrs â† route["duration"] / 3600
    
    TRáº¢ Vá»€ (geometry, distance_km, duration_hrs)
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M ROUTE_STEPS(lon1, lat1, lon2, lat2, vehicle_type):
------------------------------------------------------------
INPUT: Tá»a Ä‘á»™ 2 Ä‘iá»ƒm vÃ  loáº¡i phÆ°Æ¡ng tiá»‡n
OUTPUT: None (in ra mÃ n hÃ¬nh)

Báº®T Äáº¦U
    url â† "https://router.project-osrm.org/route/v1/{vehicle_type}/{lon1},{lat1};{lon2},{lat2}"
    params â† {overview: "false", steps: "true"}
    
    Gá»¬I GET request Ä‘áº¿n url vá»›i params
    NHáº¬N response dáº¡ng JSON
    
    route â† response["routes"][0]
    dist_km â† route["distance"] / 1000
    dur_min â† route["duration"] / 60
    
    // XÃ¡c Ä‘á»‹nh tÃªn phÆ°Æ¡ng tiá»‡n
    Náº¾U vehicle_type == "driving":
        vehicle_name â† "ğŸš— Ã” TÃ”"
    NGÆ¯á»¢C Láº I:
        vehicle_name â† "ğŸï¸ XE MÃY"
    
    IN tiÃªu Ä‘á» vá»›i vehicle_name
    IN "QuÃ£ng Ä‘Æ°á»ng: " + dist_km + " km"
    IN "Thá»i gian Æ°á»›c tÃ­nh: " + dur_min + " phÃºt"
    IN "--- CHá»ˆ DáºªN CHI TIáº¾T ---"
    
    step_number â† 1
    FOR má»—i leg TRONG route["legs"]:
        FOR má»—i step TRONG leg["steps"]:
            instruction â† step["maneuver"]["instruction"] HOáº¶C "Tiáº¿p tá»¥c Ä‘i"
            street_name â† step["name"] HOáº¶C ""
            distance_m â† step["distance"]
            
            // Format khoáº£ng cÃ¡ch
            Náº¾U distance_m >= 1000:
                distance_str â† (distance_m / 1000) + " km"
            NGÆ¯á»¢C Láº I:
                distance_str â† distance_m + " m"
            
            // In chá»‰ dáº«n
            Náº¾U street_name KHÃ”NG Rá»–NG:
                IN step_number + ". " + instruction + " vÃ o " + street_name + " (" + distance_str + ")"
            NGÆ¯á»¢C Láº I:
                IN step_number + ". " + instruction + " (" + distance_str + ")"
            
            step_number â† step_number + 1
    
    IN "âœ… ÄÃƒ Äáº¾N ÄÃCH!"
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M GET_VEHICLE_CHOICE():
------------------------------------------------------------
OUTPUT: "driving" hoáº·c "bike" hoáº·c "both"

Báº®T Äáº¦U
    IN "=== CHá»ŒN LOáº I PHÆ¯Æ NG TIá»†N ==="
    IN "1. ğŸš— Ã” tÃ´"
    IN "2. ğŸï¸ Xe mÃ¡y"
    IN "3. ğŸ”„ So sÃ¡nh cáº£ hai"
    
    Láº¶P Láº I MÃƒI:
        choice â† NHáº¬P tá»« ngÆ°á»i dÃ¹ng
        
        Náº¾U choice == "1":
            TRáº¢ Vá»€ "driving"
        NGÆ¯á»¢C Láº I Náº¾U choice == "2":
            TRáº¢ Vá»€ "bike"
        NGÆ¯á»¢C Láº I Náº¾U choice == "3":
            TRáº¢ Vá»€ "both"
        NGÆ¯á»¢C Láº I:
            IN "âŒ Lá»±a chá»n khÃ´ng há»£p lá»‡! Vui lÃ²ng chá»n 1, 2 hoáº·c 3."
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M GET_USER_LOCATIONS():
------------------------------------------------------------
OUTPUT: (lat1, lon1, name1, lat2, lon2, name2) hoáº·c None

Báº®T Äáº¦U
    IN "=== NHáº¬P Äá»ŠA CHá»ˆ ==="
    
    start_address â† NHáº¬P "Äá»‹a chá»‰ báº¯t Ä‘áº§u: "
    Náº¾U start_address Rá»–NG:
        start_address â† "Dinh Thá»‘ng Nháº¥t, TPHCM, Viá»‡t Nam"  // Máº·c Ä‘á»‹nh
        IN "â†’ Sá»­ dá»¥ng máº·c Ä‘á»‹nh: " + start_address
    
    end_address â† NHáº¬P "Äá»‹a chá»‰ Ä‘áº¿n: "
    Náº¾U end_address Rá»–NG:
        end_address â† "SÃ¢n bay TÃ¢n SÆ¡n Nháº¥t, TPHCM, Viá»‡t Nam"  // Máº·c Ä‘á»‹nh
        IN "â†’ Sá»­ dá»¥ng máº·c Ä‘á»‹nh: " + end_address
    
    IN "ğŸ” Äang tÃ¬m kiáº¿m Ä‘á»‹a chá»‰..."
    
    THá»¬:
        lat1, lon1, name1 â† GEOCODE(start_address)
        IN "âœ“ Äiá»ƒm Ä‘áº§u: " + name1
        
        lat2, lon2, name2 â† GEOCODE(end_address)
        IN "âœ“ Äiá»ƒm Ä‘áº¿n: " + name2
        
        TRáº¢ Vá»€ (lat1, lon1, name1, lat2, lon2, name2)
    Báº®T Lá»–I Exception AS e:
        IN "âŒ Lá»—i: " + e
        TRáº¢ Vá»€ None
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M SHOW_ROUTE_FOR_VEHICLE(lon1, lat1, lon2, lat2, name1, name2, vehicle_type):
------------------------------------------------------------
INPUT: Tá»a Ä‘á»™, tÃªn Ä‘á»‹a Ä‘iá»ƒm, loáº¡i phÆ°Æ¡ng tiá»‡n
OUTPUT: None (hiá»ƒn thá»‹ chá»‰ Ä‘Æ°á»ng vÃ  váº½ báº£n Ä‘á»“)

Báº®T Äáº¦U
    Náº¾U vehicle_type == "driving":
        vehicle_name â† "ğŸš— Ã” TÃ”"
    NGÆ¯á»¢C Láº I:
        vehicle_name â† "ğŸï¸ XE MÃY"
    
    IN "=== TÃŒM ÄÆ¯á»œNG CHO " + vehicle_name + " ==="
    
    // Hiá»ƒn thá»‹ chá»‰ dáº«n
    Gá»ŒI ROUTE_STEPS(lon1, lat1, lon2, lat2, vehicle_type)
    
    // Váº½ báº£n Ä‘á»“
    Gá»ŒI DRAW_SINGLE_VEHICLE_MAP(lon1, lat1, lon2, lat2, name1, name2, vehicle_type)
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M DRAW_SINGLE_VEHICLE_MAP(lon1, lat1, lon2, lat2, name1, name2, vehicle_type):
------------------------------------------------------------
INPUT: Tá»a Ä‘á»™, tÃªn Ä‘á»‹a Ä‘iá»ƒm, loáº¡i phÆ°Æ¡ng tiá»‡n
OUTPUT: File HTML báº£n Ä‘á»“

Báº®T Äáº¦U
    Náº¾U vehicle_type == "driving":
        vehicle_name â† "Ã” tÃ´"
        vehicle_icon â† "ğŸš—"
        color â† "blue"
    NGÆ¯á»¢C Láº I:
        vehicle_name â† "Xe mÃ¡y"
        vehicle_icon â† "ğŸï¸"
        color â† "orange"
    
    IN "=== Váº¼ Báº¢N Äá»’ CHO " + vehicle_icon + " " + vehicle_name.upper() + " ==="
    
    // Láº¥y tuyáº¿n Ä‘Æ°á»ng
    IN vehicle_icon + " Äang tÃ­nh toÃ¡n tuyáº¿n Ä‘Æ°á»ng..."
    geometry, km, hrs â† OSRM_GEOM(lon1, lat1, lon2, lat2, vehicle_type)
    IN "âœ“ " + vehicle_name + ": " + km + " km, " + (hrs * 60) + " phÃºt"
    
    // TÃ­nh toÃ¡n center vÃ  zoom
    center_lat â† (lat1 + lat2) / 2
    center_lon â† (lon1 + lon2) / 2
    
    Náº¾U km < 10:
        zoom â† 13
    NGÆ¯á»¢C Láº I Náº¾U km < 50:
        zoom â† 11
    NGÆ¯á»¢C Láº I Náº¾U km < 200:
        zoom â† 9
    NGÆ¯á»¢C Láº I:
        zoom â† 7
    
    // Táº¡o báº£n Ä‘á»“ Folium
    map â† Táº O báº£n Ä‘á»“ táº¡i (center_lat, center_lon) vá»›i zoom_start = zoom
    
    // ThÃªm markers
    THÃŠM Marker mÃ u xanh lÃ¡ táº¡i (lat1, lon1) vá»›i popup = name1, icon = "play"
    THÃŠM Marker mÃ u Ä‘á» táº¡i (lat2, lon2) vá»›i popup = name2, icon = "stop"
    
    // Váº½ Ä‘Æ°á»ng
    latlon â† CHUYá»‚N geometry["coordinates"] tá»« (lon,lat) sang (lat,lon)
    THÃŠM PolyLine mÃ u color, Ä‘á»™ dÃ y 5, opacity 0.7 vá»›i popup thÃ´ng tin
    
    // LÆ°u file
    output_file â† "route_" + vehicle_type + ".html"
    LÆ¯U map vÃ o output_file
    IN "âœ“ ÄÃ£ lÆ°u báº£n Ä‘á»“: " + output_file
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M COMPARE_ROUTES(lon1, lat1, lon2, lat2, name1, name2):
------------------------------------------------------------
INPUT: Tá»a Ä‘á»™ vÃ  tÃªn 2 Ä‘á»‹a Ä‘iá»ƒm
OUTPUT: None (hiá»ƒn thá»‹ so sÃ¡nh vÃ  váº½ báº£n Ä‘á»“)

Báº®T Äáº¦U
    IN "=== SO SÃNH Ã” TÃ” VÃ€ XE MÃY ==="
    
    // Hiá»ƒn thá»‹ chá»‰ dáº«n cho Ã´ tÃ´
    IN "--- 1ï¸âƒ£ CHá»ˆ ÄÆ¯á»œNG CHO Ã” TÃ” ğŸš— ---"
    Gá»ŒI ROUTE_STEPS(lon1, lat1, lon2, lat2, "driving")
    
    // Hiá»ƒn thá»‹ chá»‰ dáº«n cho xe mÃ¡y
    IN "--- 2ï¸âƒ£ CHá»ˆ ÄÆ¯á»œNG CHO XE MÃY ğŸï¸ ---"
    Gá»ŒI ROUTE_STEPS(lon1, lat1, lon2, lat2, "bike")
    
    // Váº½ báº£n Ä‘á»“ so sÃ¡nh
    Gá»ŒI DRAW_COMPARISON_MAP(lon1, lat1, lon2, lat2, name1, name2)
Káº¾T THÃšC

------------------------------------------------------------
HÃ€M DRAW_COMPARISON_MAP(lon1, lat1, lon2, lat2, name1, name2):
------------------------------------------------------------
INPUT: Tá»a Ä‘á»™ vÃ  tÃªn 2 Ä‘á»‹a Ä‘iá»ƒm
OUTPUT: File HTML báº£n Ä‘á»“ so sÃ¡nh

Báº®T Äáº¦U
    IN "=== Váº¼ Báº¢N Äá»’ SO SÃNH ==="
    
    // Láº¥y tuyáº¿n Ä‘Æ°á»ng cho Ã´ tÃ´
    IN "ğŸš— Äang tÃ­nh toÃ¡n tuyáº¿n Ä‘Æ°á»ng Ã´ tÃ´..."
    geom_car, km_car, hrs_car â† OSRM_GEOM(lon1, lat1, lon2, lat2, "driving")
    IN "âœ“ Ã” tÃ´: " + km_car + " km, " + (hrs_car * 60) + " phÃºt"
    
    // Láº¥y tuyáº¿n Ä‘Æ°á»ng cho xe mÃ¡y
    IN "ğŸï¸ Äang tÃ­nh toÃ¡n tuyáº¿n Ä‘Æ°á»ng xe mÃ¡y..."
    geom_bike, km_bike, hrs_bike â† OSRM_GEOM(lon1, lat1, lon2, lat2, "bike")
    IN "âœ“ Xe mÃ¡y: " + km_bike + " km, " + (hrs_bike * 60) + " phÃºt"
    
    // Táº¡o báº£n Ä‘á»“
    center_lat â† (lat1 + lat2) / 2
    center_lon â† (lon1 + lon2) / 2
    map â† Táº O báº£n Ä‘á»“ táº¡i (center_lat, center_lon) vá»›i zoom_start = 13
    
    // ThÃªm markers
    THÃŠM Marker mÃ u xanh lÃ¡ táº¡i (lat1, lon1) vá»›i popup = name1, icon = "play"
    THÃŠM Marker mÃ u Ä‘á» táº¡i (lat2, lon2) vá»›i popup = name2, icon = "stop"
    
    // Váº½ Ä‘Æ°á»ng Ã´ tÃ´ (mÃ u xanh dÆ°Æ¡ng)
    latlon_car â† CHUYá»‚N geom_car["coordinates"] tá»« (lon,lat) sang (lat,lon)
    THÃŠM PolyLine mÃ u "blue", Ä‘á»™ dÃ y 5, opacity 0.7
    
    // Váº½ Ä‘Æ°á»ng xe mÃ¡y (mÃ u Ä‘á»)
    latlon_bike â† CHUYá»‚N geom_bike["coordinates"] tá»« (lon,lat) sang (lat,lon)
    THÃŠM PolyLine mÃ u "red", Ä‘á»™ dÃ y 5, opacity 0.7
    
    // ThÃªm chÃº thÃ­ch (legend)
    legend_html â† Táº O HTML cho legend vá»›i thÃ´ng tin km_car vÃ  km_bike
    THÃŠM legend_html vÃ o map
    
    // LÆ°u file
    LÆ¯U map vÃ o "route_comparison.html"
    IN "âœ“ ÄÃ£ lÆ°u báº£n Ä‘á»“: route_comparison.html"
    
    // So sÃ¡nh káº¿t quáº£
    IN "=== Káº¾T QUáº¢ SO SÃNH ==="
    IN "ğŸš— Ã” tÃ´:    " + km_car + " km  |  " + (hrs_car * 60) + " phÃºt"
    IN "ğŸï¸ Xe mÃ¡y:  " + km_bike + " km  |  " + (hrs_bike * 60) + " phÃºt"
    
    diff_km â† |km_car - km_bike|
    diff_min â† |(hrs_car * 60) - (hrs_bike * 60)|
    
    Náº¾U km_car < km_bike:
        IN "âœ… Ã” tÃ´ ngáº¯n hÆ¡n: " + diff_km + " km (" + diff_min + " phÃºt)"
    NGÆ¯á»¢C Láº I Náº¾U km_bike < km_car:
        IN "âœ… Xe mÃ¡y ngáº¯n hÆ¡n: " + diff_km + " km (" + diff_min + " phÃºt)"
    NGÆ¯á»¢C Láº I:
        IN "âœ… Cáº£ hai Ä‘i cÃ¹ng Ä‘Æ°á»ng!"
Káº¾T THÃšC

================================================================================
                           CHÆ¯Æ NG TRÃŒNH CHÃNH (MAIN)
================================================================================

Báº®T Äáº¦U
    IN "=== ğŸ—ºï¸ CHÆ¯Æ NG TRÃŒNH TÃŒM ÄÆ¯á»œNG ÄI NGáº®N NHáº¤T ==="
    
    // BÆ°á»›c 1: Láº¥y Ä‘á»‹a chá»‰ tá»« ngÆ°á»i dÃ¹ng
    locations â† Gá»ŒI GET_USER_LOCATIONS()
    Náº¾U locations == None:
        IN "âŒ KhÃ´ng thá»ƒ láº¥y Ä‘á»‹a chá»‰. ChÆ°Æ¡ng trÃ¬nh káº¿t thÃºc."
        THOÃT vá»›i mÃ£ lá»—i 1
    
    lat1, lon1, name1, lat2, lon2, name2 â† locations
    
    // BÆ°á»›c 2: Cho ngÆ°á»i dÃ¹ng chá»n phÆ°Æ¡ng tiá»‡n
    choice â† Gá»ŒI GET_VEHICLE_CHOICE()
    
    // BÆ°á»›c 3: Thá»±c hiá»‡n theo lá»±a chá»n
    Náº¾U choice == "driving":
        Gá»ŒI SHOW_ROUTE_FOR_VEHICLE(lon1, lat1, lon2, lat2, name1, name2, "driving")
    NGÆ¯á»¢C Láº I Náº¾U choice == "bike":
        Gá»ŒI SHOW_ROUTE_FOR_VEHICLE(lon1, lat1, lon2, lat2, name1, name2, "bike")
    NGÆ¯á»¢C Láº I Náº¾U choice == "both":
        Gá»ŒI COMPARE_ROUTES(lon1, lat1, lon2, lat2, name1, name2)
    
    IN "=== âœ… HOÃ€N THÃ€NH! ==="
Káº¾T THÃšC

================================================================================
                              Dá»® LIá»†U VÃ€ API
================================================================================

CÃC Háº°NG Sá»:
    NOMINATIM â† "https://nominatim.openstreetmap.org"
    OSRM â† "https://router.project-osrm.org"
    USER_AGENT â† "OSM-Demo-Combined/1.0"

CÃC API ENDPOINT:
    1. Nominatim Geocoding:
       GET https://nominatim.openstreetmap.org/search
       Params: q (Ä‘á»‹a chá»‰), format ("jsonv2"), limit (1)
       
    2. OSRM Routing:
       GET https://router.project-osrm.org/route/v1/{vehicle_type}/{lon1},{lat1};{lon2},{lat2}
       Params: overview, geometries, steps
       Vehicle_type: "driving" (Ã´ tÃ´) hoáº·c "bike" (xe mÃ¡y)

CÃC FILE OUTPUT:
    - route_driving.html: Báº£n Ä‘á»“ cho Ã´ tÃ´
    - route_bike.html: Báº£n Ä‘á»“ cho xe mÃ¡y
    - route_comparison.html: Báº£n Ä‘á»“ so sÃ¡nh 2 loáº¡i xe

================================================================================
                            GHI CHÃš VÃ€ Äá»˜ PHá»¨C Táº P
================================================================================

Äá»˜ PHá»¨C Táº P THá»œI GIAN:
    - geocode(): O(1) - API call
    - osrm_geom(): O(1) - API call
    - route_steps(): O(n) - n lÃ  sá»‘ bÆ°á»›c trong tuyáº¿n Ä‘Æ°á»ng
    - draw_map(): O(m) - m lÃ  sá»‘ Ä‘iá»ƒm trong geometry

Äá»˜ PHá»¨C Táº P KHÃ”NG GIAN:
    - O(n) cho lÆ°u trá»¯ tá»a Ä‘á»™ vÃ  geometry

LÆ¯U Ã:
    - CÃ³ delay 1 giÃ¢y giá»¯a cÃ¡c request Ä‘á»ƒ trÃ¡nh spam API
    - Xá»­ lÃ½ lá»—i khi khÃ´ng tÃ¬m tháº¥y Ä‘á»‹a chá»‰
    - Tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh zoom dá»±a trÃªn khoáº£ng cÃ¡ch
    - Há»— trá»£ Ä‘á»‹a chá»‰ máº·c Ä‘á»‹nh náº¿u ngÆ°á»i dÃ¹ng khÃ´ng nháº­p

================================================================================
